/*
  Copyright (c) Joshua Barnett 2019
  Licensed under MIT
*/

class Point{constructor(){this.x=0,this.y=0}clone(){return this}}class Game{constructor(t,e,i={ticker:!0}){var s=this,n=document.createElement("canvas"),r=n.getContext("2d");r.canvas.height=t,r.canvas.width=e,this.view=r.canvas,this.draw=r,this.tick=!1,this.onclick,this.onmousemove,this.onkeydown,this.onmousedown,this.elements={sprites:[]},this.resources={},this.screen={add:{},clear:{},mousePos:{}},this.view.onclick=function(t){if(s.onclick)return s.onclick(t)},document.onmousemove=function(t){if(s.onmousemove)return s.onmousemove(t)},document.onkeydown=function(t){if(s.onkeydown)return s.onkeydown(t)},document.onmousedown=function(t){if(s.onmousedown)return s.onmousedown(t)},document.onmouseup=function(t){if(s.onmouseup)return s.onmouseup(t)},this.elements.add=function(t="default",e={id:"rect",h:10,w:10,color:"#000000"}){return s.resources[t]=e,s.loader},this.screen.add=function(t){return t.render(r)},this.screen.clear=function(){r.clearRect(0,0,r.canvas.width,r.canvas.height)},this.screen.on=function(t,e){s["on"+t]=e},this.screen.mousePos=function(t){var e=n.getBoundingClientRect(),i=n.width/e.width,s=n.height/e.height;return{x:(t.clientX-e.left)*i,y:(t.clientY-e.top)*s}},i.ticker&&this._animFrame(this)}addChild(t){this.elements.sprites.push(t)}removeChildren(){this.elements.sprites=[]}_animFrame(t){t.elements.sprites.length>=1&&t.screen.clear();for(var e=0;e<t.elements.sprites.length;e++)t.screen.add(t.elements.sprites[e]);requestAnimationFrame(t._tick.bind(!1,t)),requestAnimationFrame(t._animFrame.bind(!1,t))}_tick(t){t.tick&&t.tick()}render(){var t=this.elements.sprites.length;t>=1&&this.screen.clear();for(var e=0;e<t;e++)this.screen.add(this.elements.sprites[e])}}class SpriteBase{constructor(){this.point=new Point}get x(){return this.point.x}set x(t){return this.point.x=t}get y(){return this.point.y}set y(t){return this.point.y=t}clone(){return this}}class Sprite extends SpriteBase{constructor(t){super();this.texture=t}render(t){this.texture.renderable&&t.drawImage(this.texture.image,this.x,this.y)}}class Rectangle extends SpriteBase{constructor(t,e,i="#000000"){super(),this.width=t,this.height=e,this.color=i}render(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height),t.fill()}}class Circle extends SpriteBase{constructor(t,e="#000000"){super(),this.radius=t,this.color=e}render(t){t.beginPath(),t.fillStyle=this.color,t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill()}}class Text extends SpriteBase{constructor(t,e,i="#000000"){super(),this.text=t,this.size=e,this.color=i}render(t){t.beginPath(),t.fillStyle=this.color,t.font=this.size+"px Verdana",t.fillText(this.text,this.x,this.y),t.fill()}}class Container{constructor(){this.contents=[],this.container=!0,this.point=new Point}addChild(t){this.contents.push(t)}cloneChildren(t){var e=this.contents;for(var i in e)t.addChild(e[i])}get x(){return this.point.x}get y(){return this.point.y}set x(t){var e=this.contents;for(var i in e){var s=e[i];s.x=s.x+(t-this.x)}this.point.x=t}set y(t){var e=this.contents;for(var i in e){var s=e[i];s.y=s.y+(t-this.y)}this.point.y=t}render(t){var e=this.contents;for(var i in e)e[i].render(t)}}class Sound{constructor(){}}class Texture{constructor(t){var e=this;this.image=new Image,this.renderable=!1,this.image.onload=function(){e.renderable=!0},this.image.src=t}}class FillStyle{constructor(){this.reset()}reset(){this.color=16777215,this.alpha=1}clone(){var t=new FillStyle;return t.color=this.color,t.alpha=this.alpha,t}fill(t){return this.color=t,this.color}}class ImageGraphics{constructor(t){this.ctx=t,this.cctx,this.canvas,this.image=new Image,this.renderabe=!1,this.width=0,this.height=0,this.math=!1}loadImage(t){var e=this;return new Promise(function(i,s){e.image.onload=function(){return e.renderable=!0,e.math=!0,e.width=e.image.width,e.height=e.image.height,i(e)},e.image.src=t})}cropRect(t,e,i,s){this.canvas=document.createElement("canvas"),this.cctx=this.canvas.getContext("2d"),this.cctx.canvas.width=this.width,this.cctx.canvas.height=this.height,this.cctx.drawImage(this.image,0,0);var n=this.cctx.getImageData(t,e,i,s);return this.cctx.clearRect(0,0,this.width,this.height),this.canvas.width=i,this.canvas.height=s,this.cctx.putImageData(n,0,0),{x:0,y:0,image:this.canvas,render:function(t){t.drawImage(this.image,this.x,this.y)},clone:function(){var t=this;return{x:t.x,y:t.y,image:t.image,render:t.render}}}}}class Graphics extends ImageGraphics{constructor(t){super(t),this.ctx=t,this.dsc=this.ctx.shadowColor,this._fillStyle=new FillStyle}transparency(t){return this.ctx.globalAlpha=t,this}shadow(t,e,i,s){return this.ctx.shadowBlur=t,this.ctx.shadowColor=e,this.ctx.shadowOffsetX=i,this.ctx.shadowOffsetY=s,this}fill(t){return this.ctx.fillStyle=this._fillStyle.fill(t),this}end(){this._fillStyle.reset(),this.ctx.fillStyle="#000000",this.ctx.shadowBlur=0,this.ctx.shadowColor=this.dsc,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.globalAlpha=1}drawRect(t,e,i,s){return this.ctx.fillRect(t,e,i,s),this}arc(t,e,i,s,n,r=!1){return this.ctx.beginPath(),this.ctx.arc(t,e,i,s,n,r),this.ctx.fill(),this}arcTo(t,e,i,s,n){return this.ctx.beginPath(),this.ctx.arcTo(t,e,i,s,n),this.ctx.fill(),this}move(t,e){return this.ctx.moveTo(t,e),this}clearRect(t,e,i,s){return this.ctx.clearRect(t,e,i,s),this}clearCircle(t,e,i){this.ctx.globalCompositeOperation="destination-out",this.ctx.arc(t,e,i,0,2*Math.PI),this.ctx.fill(),this.ctx.globalCompositeOperation="source-over"}}window.Pixel={Game:Game,Sprite:Sprite,Texture:Texture,Rectangle:Rectangle,Circle:Circle,Text:Text,Sound:Sound,Point:Point,Container:Container,Graphics:Graphics},window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)};
