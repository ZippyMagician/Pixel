/*
  Copyright (c) Joshua Barnett 2019
  All rights reserved
*/
function game(e,t,i={ticker:!0}){var n=document.createElement("canvas").getContext("2d");n.canvas.height=e,n.canvas.width=t,this.view=n.canvas,this.autoTick=i.ticker,this.draw=n,this.onclick;var r=this;this.elements={sprites:[]},this.resources={},this.screen={};var o={texture:function(e){e.img.onload=function(){n.drawImage(e.img,sX,sY)},e.img.src=e.src},"texture-preload":function(e){n.drawImage(e.img,e.x,e.y)},rect:function(e){n.fillStyle=e.color,n.fillRect(e.x,e.y,e.w,e.h),n.fill()},circle:function(e){n.fillStyle=e.color,n.beginPath(),n.arc(e.x,e.y,e.r,0,2*Math.PI),n.fill()},text:function(e){n.beginPath(),n.fillStyle=e.color,n.font=e.size+"px Verdana",n.fillText(e.text,e.x,e.y),n.fill()}};function s(e,t){var i=e.getBoundingClientRect(),n=e.width/i.width,r=e.height/i.height;return{x:(t.clientX-i.left)*n,y:(t.clientY-i.top)*r}}this.view.onclick=function(e){if(r.onclick)return r.onclick(e)},this.loader={load:function(e){return e(r.resources)}},this.elements.add=function(e="default",t={id:"rect",h:10,w:10,color:"#000000"}){return r.resources[e]=t,r.loader},this._rotate=function(e,t,i,r){if(0===i)return r();n.save(),n.translate(e,t),n.rotate(i*Math.PI/180),r(),n.restore()},this.screen.add=function(e){return o[e.id](e)},this.screen.clear=function(){n.clearRect(0,0,n.canvas.width,n.canvas.height)},this.screen.mouseX=function(e){return s(r.view,e).x},this.screen.mouseY=function(e){return s(r.view,e).y},this.texture=function(e){return{img:new Image,src:e,id:"texture"}},this.rectangle=function(e,t,i="#000000"){return{id:"rect",w:e,h:t,color:i}},this.text=function(e="Hello World!",t=10,i="#000000"){return{id:"text",txt:e,color:i,size:t}},this.circle=function(e,t="#000000"){return{id:"circle",r:e,color:t}},this.sprite=function(e){var t=this;this.x=0,this.y=0,this.pivotX=0,this.pivotY=0,this.deg=0,this.id=e.id,this.anchor=function(e,i){if("rect"!==t.id)return console.log("Anchoring an image, circle, or text is not yet supported");t.pivotX=t.x+t.w*e,t.pivotY=t.y+t.h*i},"rect"===e.id?(this.w=e.w,this.h=e.h,this.color=e.color):"texture"===e.id?this.img=e.img:"circle"===e.id?(this.r=e.r,this.color=e.color):"text"===e.id&&(this.text=e.txt,this.color=e.color,this.size=e.size)},this.sound=function(e){var t=new Audio(e);return{play:function(){t.play()}}},this.addChild=function(e){r.elements.sprites.push(e)},this.removeChildren=function(){r.elements.sprites=[]},this._animFrame=async function(){r.elements.sprites.length>=1&&r.screen.clear();for(var e=0;e<r.elements.sprites.length;e++)r.screen.add(r.elements.sprites[e]);await requestAnimationFrame(r._tick),await requestAnimationFrame(r._animFrame)},this._tick=function(){void 0!==r.tick|null&&r.tick()},this.render=function(){var e,t=r.elements.sprites.length;for(t>=1&&r.screen.clear(),e=0;e<t;e++)r.screen.add(r.elements.sprites[e])},r.autoTick&&this._animFrame()}window.Pixel={Game:game,Sprite:(new game).sprite,Texture:(new game).texture,Rectangle:(new game).rectangle,Circle:(new game).circle,Text:(new game).text,Sound:(new game).sound,PreTexture:function(){return{id:"texture-preload",x:0,y:0,pivotX:0,pivotY:0,deg:0,img:null}},DummySprite:function(){return{id:null,x:0,y:0,pivotX:0,pivotY:0,deg:0,img:0,w:0,h:0,r:0,color:"#000000",size:0}}},window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)};
