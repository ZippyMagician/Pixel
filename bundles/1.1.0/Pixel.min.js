/*
  Copyright (c) Joshua Barnett 2019
  Licensed under MIT
*/

class Point{constructor(){this.x=0,this.y=0}clone(){return this}}class Game{constructor(e,t,i={ticker:!0}){var s=this,r=document.createElement("canvas"),n=r.getContext("2d");n.canvas.height=e,n.canvas.width=t,this.view=n.canvas,this.draw=n,this.onclick,this.tick=!1,this.elements={sprites:[]},this.resources={},this.screen={add:{},clear:{},mousePos:{}},this.view.onclick=function(e){if(s.onclick)return s.onclick(e)},this.elements.add=function(e="default",t={id:"rect",h:10,w:10,color:"#000000"}){return s.resources[e]=t,s.loader},this.screen.add=function(e){return e.render(n)},this.screen.clear=function(){n.clearRect(0,0,n.canvas.width,n.canvas.height)},this.screen.mousePos=function(e){var t=r.getBoundingClientRect(),i=r.width/t.width,s=r.height/t.height;return{x:(e.clientX-t.left)*i,y:(e.clientY-t.top)*s}},i.ticker&&this._animFrame(this)}addChild(e){this.elements.sprites.push(e)}removeChildren(){this.elements.sprites=[]}_animFrame(e){e.elements.sprites.length>=1&&e.screen.clear();for(var t=0;t<e.elements.sprites.length;t++)e.screen.add(e.elements.sprites[t]);requestAnimationFrame(e._tick.bind(!1,e)),requestAnimationFrame(e._animFrame.bind(!1,e))}_tick(e){e.tick&&e.tick()}render(){var e=this.elements.sprites.length;e>=1&&this.screen.clear();for(var t=0;t<e;t++)this.screen.add(this.elements.sprites[t])}}class SpriteBase{constructor(){this.point=new Point}get x(){return this.point.x}set x(e){return this.point.x=e}get y(){return this.point.y}set y(e){return this.point.y=e}clone(){return this}}class Sprite extends SpriteBase{constructor(e){super();this.texture=e}render(e){this.texture.renderable&&e.drawImage(this.texture.image,this.x,this.y)}}class Rectangle extends SpriteBase{constructor(e,t,i="#000000"){super(),this.width=e,this.height=t,this.color=i}render(e){e.fillStyle=this.color,e.fillRect(this.x,this.y,this.width,this.height),e.fill()}}class Circle extends SpriteBase{constructor(e,t="#000000"){super(),this.radius=e,this.color=t}render(e){e.beginPath(),e.fillStyle=this.color,e.arc(this.x,this.y,this.radius,0,2*Math.PI),e.fill()}}class Text extends SpriteBase{constructor(e,t,i="#000000"){super(),this.text=e,this.size=t,this.color=i}render(e){e.beginPath(),e.fillStyle=this.color,e.font=this.size+"px Verdana",e.fillText(this.text,this.x,this.y),e.fill()}}class Sound{constructor(){}}class Texture{constructor(e){var t=this;this.image=new Image,this.renderable=!1,this.image.onload=function(){t.renderable=!0},this.image.src=e}}window.Pixel={Game:Game,Sprite:Sprite,Texture:Texture,Rectangle:Rectangle,Circle:Circle,Text:Text,Sound:Sound,Point:Point},window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)};
