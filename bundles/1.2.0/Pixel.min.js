/*
  Copyright (c) Joshua Barnett 2019
  Licensed under MIT
*/

class Point{constructor(){this.x=0,this.y=0}clone(){return this}}class Game{constructor(t,e,i={ticker:!0}){var s=this,r=document.createElement("canvas"),n=r.getContext("2d");n.canvas.height=t,n.canvas.width=e,this.view=n.canvas,this.draw=n,this.onclick,this.tick=!1,this.elements={sprites:[]},this.resources={},this.screen={add:{},clear:{},mousePos:{}},this.view.onclick=function(t){if(s.onclick)return s.onclick(t)},this.elements.add=function(t="default",e={id:"rect",h:10,w:10,color:"#000000"}){return s.resources[t]=e,s.loader},this.screen.add=function(t){return t.render(n)},this.screen.clear=function(){n.clearRect(0,0,n.canvas.width,n.canvas.height)},this.screen.mousePos=function(t){var e=r.getBoundingClientRect(),i=r.width/e.width,s=r.height/e.height;return{x:(t.clientX-e.left)*i,y:(t.clientY-e.top)*s}},i.ticker&&this._animFrame(this)}addChild(t){this.elements.sprites.push(t)}removeChildren(){this.elements.sprites=[]}_animFrame(t){t.elements.sprites.length>=1&&t.screen.clear();for(var e=0;e<t.elements.sprites.length;e++)t.screen.add(t.elements.sprites[e]);requestAnimationFrame(t._tick.bind(!1,t)),requestAnimationFrame(t._animFrame.bind(!1,t))}_tick(t){t.tick&&t.tick()}render(){var t=this.elements.sprites.length;t>=1&&this.screen.clear();for(var e=0;e<t;e++)this.screen.add(this.elements.sprites[e])}}class SpriteBase{constructor(){this.point=new Point}get x(){return this.point.x}set x(t){return this.point.x=t}get y(){return this.point.y}set y(t){return this.point.y=t}clone(){return this}}class Sprite extends SpriteBase{constructor(t){super();this.texture=t}render(t){this.texture.renderable&&t.drawImage(this.texture.image,this.x,this.y)}}class Rectangle extends SpriteBase{constructor(t,e,i="#000000"){super(),this.width=t,this.height=e,this.color=i}render(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height),t.fill()}}class Circle extends SpriteBase{constructor(t,e="#000000"){super(),this.radius=t,this.color=e}render(t){t.beginPath(),t.fillStyle=this.color,t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill()}}class Text extends SpriteBase{constructor(t,e,i="#000000"){super(),this.text=t,this.size=e,this.color=i}render(t){t.beginPath(),t.fillStyle=this.color,t.font=this.size+"px Verdana",t.fillText(this.text,this.x,this.y),t.fill()}}class Container{constructor(){this.contents=[],this.container=!0,this.point=new Point}addChild(t){this.contents.push(t)}cloneChildren(t){var e=this.contents;for(var i in e)t.addChild(e[i])}get x(){return this.point.x}get y(){return this.point.y}set x(t){var e=this.contents;for(var i in e){var s=e[i];s.x=s.x+(t-this.x)}this.point.x=t}set y(t){var e=this.contents;for(var i in e){var s=e[i];s.y=s.y+(t-this.y)}this.point.y=t}render(t){var e=this.contents;for(var i in e)e[i].render(t)}}class Sound{constructor(){}}class Texture{constructor(t){var e=this;this.image=new Image,this.renderable=!1,this.image.onload=function(){e.renderable=!0},this.image.src=t}}window.Pixel={Game:Game,Sprite:Sprite,Texture:Texture,Rectangle:Rectangle,Circle:Circle,Text:Text,Sound:Sound,Point:Point,Container:Container},window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)};
